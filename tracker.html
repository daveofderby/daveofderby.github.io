<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Location Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 50vh;
        width: 100%;
      }
      html,
      body {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="info"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- <script src="app.js"></script> -->
  </body>
</html>

<script>
  const lat01 = 52.8902;
  const lon01 = -1.502752;
  const lat02 = 52.890486;
  const lon02 = -1.502613;

  function degreesToRadians(degrees) {
    return degrees * (Math.PI / 180);
  }

  function calculateDistance(lat01, lon01, lat02, lon02) {
    const R = 6371; // Earth's radius in kilometers
    const rlat1 = degreesToRadians(lat01);
    const rlat2 = degreesToRadians(lat02);
    const difflat = rlat2 - rlat1;
    const difflon = degreesToRadians(lon02) - degreesToRadians(lon01);

    const d = 2 * R * Math.asin(Math.sqrt(Math.sin(difflat / 2) * Math.sin(difflat / 2) + Math.cos(rlat1) * Math.cos(rlat2) * Math.sin(difflon / 2) * Math.sin(difflon / 2)));
    return d * 1000; // in metres
  }

  function calculateBearing(lat1, lon1, lat2, lon2) {
    const rlat1 = degreesToRadians(lat1);
    const rlat2 = degreesToRadians(lat2);
    const difflon = degreesToRadians(lon2) - degreesToRadians(lon1);

    const y = Math.sin(difflon) * Math.cos(rlat2);
    const x = Math.cos(rlat1) * Math.sin(rlat2) - Math.sin(rlat1) * Math.cos(rlat2) * Math.cos(difflon);
    const brng = Math.atan2(y, x); // in radians

    // Convert radians to degrees and normalize to 0-360
    return (brng * (180 / Math.PI) + 360) % 360;
  }

  const distance = calculateDistance(lat01, lon01, lat02, lon02);
  const bearing = calculateBearing(lat01, lon01, lat02, lon02);

  console.log(`Distance: ${distance.toFixed(0)} m`); // Distance in meters
  console.log(`Initial Bearing: ${bearing.toFixed(0)}°`); // Initial bearing in degrees

  const info = document.querySelector("#info");
  info.innerHTML = `<p>From: ${lat01} / ${lon01}</p><p>To: ${lat02} / ${lon02}</p><p>Distance: ${distance.toFixed(0)} m</p><p>Initial Bearing: ${bearing.toFixed(0)}°</p>`;

  const map = L.map("map").setView([0, 0], 15); // Initial view [latitude, longitude], zoom

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: 'Map data © <a href="https://openstreetmap.org">OpenStreetMap</a>',
  }).addTo(map);

  const userMarker = L.marker([0, 0]).addTo(map);

  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(
      (position) => {
        const { latitude, longitude } = position.coords;
        const newLatLng = new L.LatLng(latitude, longitude);

        map.setView([latitude, longitude], 17);

        // Update the marker's position
        userMarker.setLatLng(newLatLng);

        // Center the map on the new position
        map.panTo(newLatLng);

        console.log(position.timestamp);
      },
      (error) => {
        console.error("Error getting location:", error);
        alert("Error: The Geolocation service failed.");
      },
      {
        enableHighAccuracy: true, // Request more accurate location
        timeout: 5000, // Wait up to 5 seconds for a result
        maximumAge: 3000, // Don't use a cached position if set to 0
      }
    );
  } else {
    alert("Geolocation is not supported by your browser.");
  }
</script>
